#!/usr/bin/env bash
# Simple wrapper for compliance-cli
set -e

# In CI/CD, compliance-cli is in PATH
if command -v compliance-cli &> /dev/null; then
    exec compliance-cli "$@"
fi

# For local development on ARM Macs, use local build
if [ -f "../compliance/bin/compliance-cli" ]; then
    exec ../compliance/bin/compliance-cli "$@"
fi

# Otherwise use Docker image
exec docker run --rm \
    -v "$(pwd):/workspace" \
    -w /workspace \
    -v "${HOME}/.config/gcloud:/root/.config/gcloud" \
    -e "PROJECT_ID=${PROJECT_ID:-u2i-tenant-webapp-nonprod}" \
    -e "REGION=${REGION:-europe-west1}" \
    gcr.io/u2i-bootstrap/compliance-cli-builder:latest \
    bash -c "compliance-cli $*"